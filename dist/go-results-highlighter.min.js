!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.GoResultsHighlighter=e()}}(function(){return function e(t,n,r){function i(a,o){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!o&&u)return u(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var g=n[a]={exports:{}};t[a][0].call(g.exports,function(e){var n=t[a][1][e];return i(n?n:e)},g,g.exports,e,t,n,r)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(){var e=document.querySelectorAll("["+o.DOM_ATTRIBUTES.RESULT_TABLE+"]");"undefined"!=typeof jQuery?(jQuery.fn.goResultsHighlighter=function(e){return this.each(function(t,n){var r=new a.default(n,e);$(r.element).data("GoResultsHighlighter",r)}),this},jQuery(e).goResultsHighlighter()):(0,u.asArray)(e).forEach(function(e){return new a.default(e)})}var s=e("./lib/wrapper"),a=r(s),o=e("./lib/settings"),u=e("./lib/utils");"complete"===document.readyState?i():document.addEventListener("DOMContentLoaded",i,!1),t.exports=a.default},{"./lib/settings":5,"./lib/utils":6,"./lib/wrapper":7}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){var n=e.getBoundingClientRect().top-t;Math.abs(n)>10&&window.scrollBy(0,n)}function a(e){for(var t={player:null,games:null,target:null};e&&e!==document;){var n=e.getAttribute(g.DOM_ATTRIBUTES.OPPONENT_PLACEMENT),r=e.getAttribute(g.DOM_ATTRIBUTES.PLAYER_PLACEMENT);if(n&&(t.games=Number(n)),r){t.player=Number(r);break}e=e.parentNode}return t.target=e,t}function o(e){e.filter(function(e){return e.row.properNextSibling}).reverse().forEach(function(e){e.row.properNextSibling===-1?e.row.parentNode.appendChild(e.row):e.row.parentNode.insertBefore(e.row,e.row.properNextSibling),e.row.properNextSibling=null})}function u(e,t){var n=e.row.parentNode,r=e.row.nextElementSibling;t.forEach(function(t){t.row.properNextSibling=t.row.nextElementSibling||-1,t.tournamentPlace<e.tournamentPlace?n.insertBefore(t.row,e.row):(n.insertBefore(t.row,r),r=t.row.nextElementSibling)})}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),g=e("./settings"),c=e("./parser"),f=r(c),h=e("./raw2table"),p=r(h),d=e("./utils"),m=function(){function e(t,n){if(i(this,e),this.settings=(0,d.defaults)(g.DEFAULT_SETTINGS,(0,g.readTableSettingsFromDOM)(t),n),t instanceof HTMLPreElement){var r=(0,p.default)(t.innerHTML,n),s=t.parentNode;s.insertBefore(r,t),s.removeChild(t),this.element=r}else this.element=t;this.element.classList&&(this.createPlayersMap(),this.bindEvents(),this.element.classList.add(this.settings.prefixCls+this.settings.tableCls),this.current=null,this.games=[],this.isRearranged=!1,this.isHighlighting=!1)}return l(e,[{key:"createPlayersMap",value:function(){this.map=(0,f.default)(this.element,this.settings),this.players=[];for(var e in this.map)this.map.hasOwnProperty(e)&&this.players.push(this.map[e])}},{key:"highlight",value:function(e){var t=this;e||(e={});var n=e.player,r=e.rearrange===!0,i=e.games,s=this.map[n],a=(0,g.toPrefixedClasses)(this.settings);this.isRearranged&&o(this.players),s&&r?(u(s,s.opponents.map(function(e){return t.map[e]})),this.element.classList.add(a.rearrangedCls),this.isRearranged=!0):(this.element.classList.remove(a.rearrangedCls),this.isRearranged=!1);var l=(0,d.asArray)(this.element.querySelectorAll("."+a.gameCls)),c=this.element.querySelector("."+a.currentCls),f=c?c.getAttribute(g.DOM_ATTRIBUTES.PLAYER_PLACEMENT):null,h=f?this.map[f]:null,p=function(e,n){var r=n?"add":"remove";e.row.classList[r](a.currentCls),e.opponents.forEach(function(n){var i=t.map[n];i.row.classList[r](t.settings.prefixCls+e.games[n].cls)})};l.forEach(function(e){e.classList.remove(a.gameCls)}),h&&h!==s&&p(h,!1),s&&s!==h&&p(s,!0),this.games.length=0,s?("number"==typeof i&&(i=[i]),i&&"number"==typeof i.length?i.forEach(function(e){var r=t.map[e],i=s.games[e];r&&i&&(i.cell.classList.add(a.gameCls),r.games[n].cell.classList.add(a.gameCls),t.games.push(e))}):this.isRearranged&&s.opponents.forEach(function(e){t.map[e].games[n].cell.classList.add(a.gameCls),t.games.push(e)}),this.current=n,this.isHighlighting=!0):(this.current=null,this.isHighlighting=!1)}},{key:"configure",value:function(e){this.highlight(null),this.element.classList.remove(this.settings.prefixCls+this.settings.tableCls),this.settings=(0,d.defaults)(this.settings,e),this.createPlayersMap(),this.element.classList.add(this.settings.prefixCls+this.settings.tableCls)}},{key:"bindEvents",value:function(){var e=this,t=!1;this.element.addEventListener("touchstart",function(){t=!1}),this.element.addEventListener("touchmove",function(){t=!0}),this.element.addEventListener("touchend",function(n){if(!(t||e.settings.rearranging===!1&&e.settings.hovering===!1)){var r=a(n.target),i=r.target,o=r.player,u=r.games;if(o){var l=!1,g=void 0;e.current===o?(e.settings.rearranging&&e.settings.hovering||(o=null),l=!e.isRearranged):!e.isRearranged&&e.settings.hovering||(l=!0),l&&(g=i.getBoundingClientRect().top),e.highlight({player:o,games:u,rearrange:l}),g&&s(i,g),n.preventDefault()}}}),this.element.addEventListener("click",function(t){if(e.settings.rearranging!==!1){var n=a(t.target),r=n.target,i=n.player,o=n.games,u=!1,l=void 0;i&&(!e.isRearranged||r.properNextSibling?u=!0:e.settings.hovering||(i=null),u&&(l=r.getBoundingClientRect().top),e.highlight({player:i,games:o,rearrange:u}),l&&s(r,l))}}),this.element.addEventListener("mouseover",function(t){if(e.settings.hovering!==!1){var n=a(t.target),r=n.player,i=n.games,s=e.isRearranged;if(r){if(e.isRearranged){if((!i||r!==e.current)&&e.games.length===e.map[e.current].opponents.length)return;r!==e.current&&(r=e.current,i=null)}e.highlight({player:r,rearrange:s,games:i})}}},!1),this.element.addEventListener("mouseout",function(t){if(e.settings.hovering!==!1){for(var n=t.relatedTarget;n&&n!==document&&n!==e.element;)n=n.parentNode;n!==e.element&&(e.isRearranged&&e.games.length!==e.map[e.current].opponents.length?e.highlight({player:e.current,rearrange:!0}):e.isRearranged||e.highlight(null))}},!1)}},{key:"clearInlineStyles",value:function(){this.players.forEach(function(e){(0,d.asArray)(e.row.childNodes).forEach(function(e){return e.removeAttribute("style")})})}}]),e}();n.default=m,m.DEFAULT_SETTINGS=g.DEFAULT_SETTINGS},{"./parser":3,"./raw2table":4,"./settings":5,"./utils":6}],3:[function(e,t,n){"use strict";function r(e,t){e.setAttribute(m.DOM_ATTRIBUTES.PLAYER_PLACEMENT,t)}function i(e,t){return e.reduce(function(e,n){return(0,d.asArray)(n.querySelectorAll(t)).forEach(function(t,n){var r=e[n];r||(r=[],e[n]=r),r.push(t.textContent)}),e},[])}function s(e,t){return e.filter(function(e){return t.some(function(t){return e.match(t.regexp)})})}function a(e,t){var n=e.length,r=s(e,t).length;return r/n>=.4}function o(e,t,n){return i(e,t).reduce(function(e,t,r){return a(t,n)&&e.push(r),e},[])}function u(e){return function(t,n){return e.indexOf(n)!==-1}}function l(e,t,n){if("string"==typeof t.roundsColumns){var r=t.roundsColumns.split(",").map(Number);return u(r)}if(!t.checkColumnsForResults)return function(){return!0};var i=o(e,t.cellTags,n);return u(i)}function g(e,t){var n=(0,m.nameHeadersToRegExp)(t.nameColumnHeaders),r=[],s=i(e,t.headerTags);return s.forEach(function(e,t){e.some(function(e){return n.some(function(t){return e.match(t)})})&&r.push(t)}),r}function c(e,t,n){n=n||.4;var r=e.length,i=e.filter(function(e){return t(e)}).length;return i/r>=n}function f(e,t){if(!t.nameCellExpression)return[];var n=new RegExp(t.nameCellExpression),r=function(e){return e.match(n)};return i(e,t.cellTags).reduce(function(e,t,n){return c(t,r)&&e.push(n),e},[])}function h(e,t){var n=[];return"string"==typeof t.nameColumns?n=t.nameColumns.split(",").map(Number):(0,d.isNumber)(t.nameColumns)?n.push(parseInt(t.nameColumns)):t.checkColumnsForPlayerNames&&(n=g(e,t),n&&0!=n.length||(n=f(e,t))),u(n)}function p(e,t){function n(e,t){t.forEach(function(t){var n=void 0,r=void 0;if(t.hasAttribute(m.DOM_ATTRIBUTES.GAME_RESULT)&&t.hasAttribute(m.DOM_ATTRIBUTES.OPPONENT_PLACEMENT))n=Number(t.getAttribute(m.DOM_ATTRIBUTES.OPPONENT_PLACEMENT)),r=t.getAttribute(m.DOM_ATTRIBUTES.GAME_RESULT);else{for(var u=0;u<o;u++){var l=t.textContent.match(a[u].regexp);if(l){if(n=Number(l[1]),r=a[u].cls,n<=0||!i.ignoreOutOfBoundsRows&&n>s.length)return;t.setAttribute(m.DOM_ATTRIBUTES.OPPONENT_PLACEMENT,n),t.setAttribute(m.DOM_ATTRIBUTES.GAME_RESULT,a[u].cls)}}if(!n)return}e.games[n]={cell:t,cls:r},e.opponents.push(n)})}var i=(0,d.defaults)(m.DEFAULT_SETTINGS,t),s=(0,d.asArray)(e.querySelectorAll(i.rowTags)),a=(0,m.toResultsWithRegExp)(i.results),o=a.length,u=l(s,i,a),g=h(s,i),c={},f=void 0,p=void 0;return s.forEach(function(e,t){if(!(t<i.startingRow)){var s=(0,d.asArray)(e.querySelectorAll(i.cellTags)),a=s.filter(u),o=s.filter(g),l=o.map(function(e){return e.textContent}).join(" "),h=-1;if(!s.length||!s[i.placeColumn])return void r(e,h);var E=parseInt(s[i.placeColumn].textContent,10),T={tournamentPlace:-1,row:e,games:{},opponents:[],name:l};if(e.setAttribute("PLAYER_NAME",l),e.hasAttribute(m.DOM_ATTRIBUTES.PLAYER_PLACEMENT))h=Number(e.getAttribute(m.DOM_ATTRIBUTES.PLAYER_PLACEMENT));else{if(p)h=p+1;else{if(isNaN(E))return void r(e,h);h=E||1}E?E<=f&&(E=f):E=f?f:1,r(e,h)}h!=-1&&(n(T,a),T.tournamentPlace=E,T.opponents.sort(function(e,t){return e>t?1:-1}),c[h]=T,f=E,p=h)}}),c}Object.defineProperty(n,"__esModule",{value:!0}),n.default=p;var d=e("./utils"),m=e("./settings")},{"./settings":5,"./utils":6}],4:[function(e,t,n){"use strict";function r(e,t){var n=document.createElement("table");if(!e)return n;var r=(0,s.defaults)(i.DEFAULT_SETTINGS,t),a=e.replace(/<br[^>]*>/gi,"\n").replace(/<\/?code[^>]*>/gi,"").split(/\r\n|\n/);if(a.length<=2&&!a[0]&&!a[1])return n;var o=(0,i.toResultsWithRegExp)(r.results),u=o.length,l=a.map(function(e){return e.replace(/([0-9]+)\s(dan|kyu)/i,"$1_$2").split(new RegExp(r.cellSeparator)).filter(function(e){return e.length>0})}).filter(function(e){return e.length>0&&0!==e[0].indexOf(";")}),g=l.reduce(function(e,t){return Math.max(e,t.length)},0),c=r.joinNames?-1:0,f=r.placeColumn+1,h=null;"string"==typeof r.roundsColumns&&(h=r.roundsColumns.split(",").map(Number));var p=void 0;return l.forEach(function(e,t){var s=document.createElement("tr"),a=e.length;if(a){if(t<r.startingRow||a<g+c){var l=document.createElement("td");l.setAttribute("colspan",g+c),l.textContent=e.join(" "),s.setAttribute(i.DOM_ATTRIBUTES.PLAYER_PLACEMENT,-1),s.appendChild(l)}else{var d=parseInt(e[r.placeColumn],10);isNaN(d)&&!p?e.forEach(function(e){var t=document.createElement("td");t.textContent=e,s.setAttribute(i.DOM_ATTRIBUTES.PLAYER_PLACEMENT,-1),s.appendChild(t)}):!function(){s.setAttribute(i.DOM_ATTRIBUTES.PLAYER_PLACEMENT,p||d);var t=[];r.joinNames&&e.splice(f,2,e[f]+"  "+e[f+1]),e.forEach(function(e,n){var r=document.createElement("td");if(r.textContent=e.replace(/_/," "),!h||h.indexOf(n)>=0)for(var a=0;a<u;a++){var l=e.match(o[a].regexp);if(l){var g=l[1];t.push(g),r.setAttribute(i.DOM_ATTRIBUTES.OPPONENT_PLACEMENT,g),r.setAttribute(i.DOM_ATTRIBUTES.GAME_RESULT,o[a].cls)}}s.appendChild(r)}),t.length&&s.setAttribute(i.DOM_ATTRIBUTES.OPPONENTS,t.join(",")),p?p+=1:p=2}()}n.appendChild(s)}}),n.setAttribute(i.DOM_ATTRIBUTES.RESULT_TABLE,""),n}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;var i=e("./settings"),s=e("./utils")},{"./settings":5,"./utils":6}],5:[function(e,t,n){"use strict";function r(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({cls:n,regexp:new RegExp(e[n])});return t}function i(e){return e&&0!=e.length?e.map(function(e){return new RegExp(e,"i")}):[]}function s(e){var t={};return o.forEach(function(n){t[n]=e.prefixCls+e[n]}),t}function a(e){var t={};return e.hasAttribute(u.SETTING_PLACE_COLUMN)&&(t.placeColumn=Number(e.getAttribute(u.SETTING_PLACE_COLUMN))),e.hasAttribute(u.SETTING_STARTING_ROW)&&(t.startingRow=Number(e.getAttribute(u.SETTING_STARTING_ROW))),e.hasAttribute(u.SETTING_ROUNDS_COLUMNS)&&(t.roundsColumns=e.getAttribute(u.SETTING_ROUNDS_COLUMNS)),e.hasAttribute(u.SETTING_REARRANGING)&&(t.rearranging="false"!==e.getAttribute(u.SETTING_REARRANGING)),e.hasAttribute(u.SETTING_HOVERING)&&(t.hovering="false"!==e.getAttribute(u.SETTING_HOVERING)),t}Object.defineProperty(n,"__esModule",{value:!0}),n.toResultsWithRegExp=r,n.nameHeadersToRegExp=i,n.toPrefixedClasses=s,n.readTableSettingsFromDOM=a;var o=(n.DEFAULT_SETTINGS={prefixCls:"go-results-",rearrangedCls:"rearranged",tableCls:"table",gameCls:"game",currentCls:"current",results:{won:"([0-9]+)\\+",lost:"([0-9]+)\\-",jigo:"([0-9]+)=",unresolved:"([0-9]+)\\?"},startingRow:0,placeColumn:0,roundsColumns:null,nameColumns:null,nameColumnHeaders:[],nameCellExpression:"(?=^.*[A-Z][a-z]{3,})(?!.*([Kk][yy][uu]|[Dd][Aa][Nn]))",rowTags:"tr",cellTags:"td",headerTags:"th",ignoreOutOfBoundsRows:!1,checkColumnsForResults:!0,checkColumnsForPlayerNames:!0,cellSeparator:"[\t ]+",joinNames:!0,hovering:!0,rearranging:!0},["rearrangedCls","tableCls","gameCls","currentCls"]),u=n.DOM_ATTRIBUTES={RESULT_TABLE:"data-go-results",SETTING_STARTING_ROW:"data-go-starting-row",SETTING_PLACE_COLUMN:"data-go-place-column",SETTING_ROUNDS_COLUMNS:"data-go-rounds-columns",SETTING_REARRANGING:"data-go-rearranging",SETTING_HOVERING:"data-go-hovering",PLAYER_PLACEMENT:"data-go-place",OPPONENT_PLACEMENT:"data-go-opponent",OPPONENT_NAME:"data-go-name",OPPONENTS:"data-go-opponents",GAME_RESULT:"data-go-result"}},{}],6:[function(e,t,n){"use strict";function r(e){return Array.prototype.slice.call(e)}function i(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.filter(function(e){return"object"===("undefined"==typeof e?"undefined":o(e))}).reverse(),s=i.length,a={};e:for(var u in e){for(var l=0;l<s;l++)if(i[l].hasOwnProperty(u)){a[u]=i[l][u];continue e}a[u]=e[u]}return a}function s(){for(var e={},t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach(function(t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}),e}function a(e){return!isNaN(parseFloat(e))&&isFinite(e)}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};n.asArray=r,n.defaults=i,n.combine=s,n.isNumber=a},{}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(this instanceof i))return new i(e,t);var n=new u.default(e,t);this.highlight=function(e,t,r){"object"===("undefined"==typeof e?"undefined":a(e))?n.highlight(e):("boolean"==typeof t&&(r=t,t=null),n.highlight({player:e,rearrange:r,games:t}))},this.configure=function(e){n.configure(e)},this.opponents=function(e){var t=n.map[e];return t?t.opponents.slice():[]},this.clearInlineStyles=function(){n.clearInlineStyles()},Object.defineProperties(this,{element:s(function(){return n.element}),isHighlighting:s(function(){return n.isHighlighting}),isRearranged:s(function(){return n.isRearranged}),player:s(function(){return n.current||null}),players:s(function(){return n.players.length}),games:s(function(){return n.games}),configuration:s(function(){var e=n.settings.results,t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return{startingRow:n.settings.startingRow,placeColumn:n.settings.placeColumn,roundsColumns:n.settings.roundsColumns,prefixCls:n.settings.prefixCls,rearrangedCls:n.settings.rearrangedCls,tableCls:n.settings.tableCls,gameCls:n.settings.gameCls,currentCls:n.settings.currentCls,rowTags:n.settings.rowTags,cellTags:n.settings.cellTags,cellSeparator:n.settings.cellSeparator,joinNames:n.settings.joinNames,ignoreOutOfBoundsRows:n.settings.ignoreOutOfBoundsRows,checkColumnsForResults:n.settings.checkColumnsForResults,results:t}}),rearranging:{set:function(e){!e&&n.isRearranged&&n.highlight(null),n.settings.rearranging=!!e},get:function(){return n.settings.rearranging},configurable:!1,enumerable:!0},hovering:{set:function(e){return n.settings.hovering=!!e},get:function(){return n.settings.hovering},configurable:!1,enumerable:!0}}),n.element.goResultsHighlighter=this}function s(e){return{get:e,enumerable:!0,configurable:!1}}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=e("./highlighter"),u=r(o);t.exports=i},{"./highlighter":2}]},{},[1])(1)});